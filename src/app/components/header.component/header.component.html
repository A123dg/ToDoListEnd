<header class="navbar">
  <div class="logo">HAH<span class="blue">A</span></div>

  <nav>
    <a routerLink="/home">TRANG CHỦ</a>
    <a routerLink="/tasks">CÔNG VIỆC</a>
    <a routerLink="/about">VỀ CHÚNG TÔI</a>
    <a routerLink="/contact">LIÊN HỆ</a>
  </nav>

  @if (isLoggedIn) {
    <div class="user-info">
      <span class="btn primary" (click)="toggleDropdown()">{{ currentUser?.username }}</span>
      <button class="btn primary" (click)="logout()">Đăng xuất</button>

      @if(dropdownOpen) {
        <div class="user-menu">
          <ul>
            <li (click)="openSidebar()">Hồ sơ</li>
            <li (click)="openChangePassword()">Đổi mật khẩu</li>
          </ul>
        </div>
      }
    </div>
  } @else {
    <div class="auth">
      <nav>
        <button class="btn primary" (click)="onLoginClick()">Đăng nhập</button>
        <button class="btn primary" (click)="onRegister()">Đăng ký</button>
      </nav>
    </div>
  }
</header>

<!-- Sidebar Hồ sơ -->
@if(sidebarOpen){
  <aside class="sidebar" [ngClass]="{ open: sidebarOpen }">
    <h2>Thông tin cá nhân</h2>
    <p><b>Tên: </b>{{currentUser?.username}}</p>
    <p><b>Email: </b>{{currentUser?.email}}</p>
    <button class="btn" (click)="openUpdateProfile()">Cập nhật</button>
    <button class="btn secondary" (click)="closeSidebar()">Đóng</button>
  </aside>
}

<!-- Modal Đổi mật khẩu -->
@if (showChangePasswordForm) {
  <div class="modal">
    <div class="modal-content">
      <div class="brand-row">
        <h3 class="brand">Đổi mật khẩu</h3>
        <button class="close" (click)="showChangePasswordForm=false">×</button>
      </div>
      <form (ngSubmit)="changePassword()">
        <label>Mật khẩu cũ:</label>
        <input type="password" [(ngModel)]="changePassModel.currentPassword" name="currentPassword" />

        <label>Mật khẩu mới:</label>
        <input type="password" [(ngModel)]="changePassModel.newPassword" name="newPassword" />

        <label>Nhập lại mật khẩu mới:</label>
        <input type="password" [(ngModel)]="changePassModel.confirmPassword" name="confirmPassword" />

        <button type="submit" class="btn primary">Đổi mật khẩu</button>
        <!-- <button type="button" class="btn secondary" (click)="showChangePasswordForm = false">Hủy</button> -->
      </form>
    </div>
  </div>
}
@if(showUpdateForm)
{
  <div class="modal">
    <div class="modal-content">
      <div class="brand-row">
        <h3 class="brand">Cập nhật thông tin</h3>
        <button class="close" (click)="showUpdateForm=false">x</button>
      </div>
      <form (ngSubmit)="updateProfile()">
        <label>Tên:</label>
        <input type="name" [(ngModel)]="updateModel.username" name="name"/>

        <label>Email:</label>
        <input type="email" [(ngModel)]="updateModel.email" name="email">
        <button type="submit" class="btn primary">Cập nhật</button>
      </form>
    </div>
  </div>
}
